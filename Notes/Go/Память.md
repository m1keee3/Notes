
## Архитектура памяти

Go не бегает каждый раз при необходимости к ОС за дополнительной памятью, он сразу запрашивает огромный кусок памяти **Arena**, которым распоряжается в дальнейшем сам

**Arena** - крупнейшая единица памяти в Go, область фиксированного размера в 64 МБ, выделенная из виртуальной памяти

Каждая Arena в свою очередь делится на более маленькие блоки по 8 КБ - **Pages**

**Span** - это просто одна или несколько страничек идущих подряд, но каждый span **содержит объекты только одного размера**

У span также есть **классы**:
- `scan` для объектов на которые хранятся указатели
- `nonscan` без указателей 

Это **ускоряет выделение памяти** и **упрощает работу GC**

В Go аллокатор использует 3 уровня:

![[Pasted image 20251104145648.png]]

Для определения куда выделить объект в Go компиляторе есть алгоритм **Escape Analysis**

---
### Escape Analysis

**Escape Analysis** — это процесс, который **Go Compiler** использует, чтобы определить, должна ли переменная храниться в **стеке (stack)** или **куче (heap)**.

Если переменная **"уходит" за пределы функции**, она **уходит в кучу (escapes to heap)**. В противном случае она остаётся в **стеке**, где её удаление дешевле и быстрее.

##### Основные правила:

1. **Если переменная используется только внутри функции**, она остается в стеке.
    
2. **Если переменная "убегает" из функции** (например, возвращается из функции по указателю, передается в замыкание или сохраняется в глобальной переменной), она перемещается в кучу.


---

### Инициализация значений по умолчанию:

Если переменная объявлена без явного значения, Go автоматически присвоит ей **нулевое значение** (zero value) в соответствии с её типом:

- **Числовые типы (int, float64 и т. д.)** → `0` (или `0.0` для float)
- **Булевый тип (bool)** → `false`
- **Строки (string)** → `""` (пустая строка)
- **Срезы, карты, каналы, интерфейсы, функции, указатели** → `nil`
- **Структуры** → все поля структуры будут инициализированы нулевыми значениями их типов




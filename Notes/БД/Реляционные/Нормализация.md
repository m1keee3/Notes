
## Аномалии

Рассмотрим такое отношение:

| ФИО | N группы |
| --- | -------- |
|     |          |

Заметим, что здесь номера групп будут дублироваться - мы должны знать группу для каждого студента, поэтому это дублирование не избыточное. Теперь расширим таблицу - добавим столбец с образовательной программой:

|ФИО|N группы|ОП|
|---|---|---|
||||

Добавление ОП добавляет избыточное дублирование: очевидно, что в одной группе студенты изучают одну образовательную программу

|ФИО|N группы|ОП|
|---|---|---|
|С1|M3200|09.03.02|
|С2|M3200|X|
|С3|M3200|X|

Здесь же (помимо избыточного выделения памяти) появляются 2 проблемы:

1) Если номер ОП дублировать на все кортежи, то при изменении номера ОП в одном кортеже в других кортежах он не поменяется - нарушается целостность

2) Если номер ОП хранить только в одном кортеже, то при поиске для другого кортежа придется искать именно тот кортеж - тратим больше времени

И в этом случае говорят, что у нашей модели появляется аномалия

> **Аномалия** - состояние базы данных, которое приводит к противоречию или существенно усложняет обработку данных

Различают 3 типа аномалий:

> 1. **Аномалия модификации** - изменение значения одной записи повлечет за собой изменение значения в другой записи

Пример: при изменении у одного студента номера ОП, зависящего от группы, приходится изменять номер ОП в других местах

> 2. **Аномалия удаления** - при удалении записи может пропасть и другая информация

Пример: при удалении всех студентов связь “N группы”-“ОП” теряется

>3. **Аномалия добавления** - информацию в таблицу нельзя поместить, пока она не полная или требуется дополнительный просмотр таблицы

Пример: при добавлении нового студента приходится искать номер ОП для других студентов из его группы

Аномалии приводят к нарушению целостности и дополнительным тратам по времени, поэтому, чтобы избежать этого, модели данных нужно нормализовать.

## Нормальные формы

Рассмотрим виды зависимостей атрибутов:

> Функциональная зависимость: в некотором отношении `x -> y` (`y` зависит от `x`) тогда и только тогда, когда каждому значению `x` соответствует в точности одно значение `y`. Тогда `x` - детерминант, `y` - зависимая часть

В примере выше номер ОП зависит от номера группы

> Частичная функциональная зависимость - зависимость не ключевого атрибута от части составного потенциального ключа

Пример: создадим такое отношение студентов:

|**ФИО**|**N группы**|ОП|Факультет|Форма обучения|
|---|---|---|---|---|
||||||

В нем сделаем ФИО и N группы первичным ключом; тогда номер ОП частично зависит от этого ключа (потому что номер ОП зависит от номера группы)

> Полная функциональная зависимость - зависимость не ключевого атрибута от всего составного потенциального ключа

> Транзитивная функциональная зависимость: атрибуты `z` транзитивно зависит от `x`, если найдется такой `y`, что `z` зависит от `y`, а `y` зависит от `x` (`x -> z => Ǝ y : x -> y, y -> z`)

Чтобы избежать зависимостей модели декомпозируют в нормальные формы.

> Отношение является **первой нормальной формой** (1НФ), если все его атрибуты являются простыми

Так как простоту атрибута мы определяем сами, то принадлежность отношения к 1-ой нормальной форме - чисто условность

> Отношение является **второй нормальной формой** (2НФ), если оно находится в 1НФ и каждый не ключевой атрибут функционально полно зависит от первичного ключа

Переделаем таблицу выше в две других: “Студент”

|ФИО|N группы|Форма обучения|
|---|---|---|
||||
и “Группа”

| N группы | ОП  | Факультет |
| -------- | --- | --------- |
|          |     |           |
Все эти отношения являются вторыми нормальными формами. В этом случае мы выиграли по памяти (при большом кол-ве студентов не будет избыточно дублироваться номер ОП), но проигрываем по времени

> Отношение является **третьей нормальной формой** (3НФ), если оно находится во 2НФ и все не ключевые атрибуты взаимно независимы и полностью зависят от первичного ключа

Также существует другое эквивалентное определение

> Отношение является **третьей нормальной формой** (3НФ), если оно находится во 2НФ и ни один не ключевой атрибут не находится в транзитивной функциональной зависимости от потенциального ключа

Рассмотрим еще раз таблицу с группами:

|N группы|ОП|Факультет|
|---|---|---|
||||
Здесь факультет транзитивно зависит от номер группы, исправим это:

Таблица “Группа”:

|N группы|ОП|
|---|---|
|||
Таблица “Образовательная программа”:

|ОП|Факультет|
|---|---|
|||
В итоге для получения связи Студент-Факультет нужно объединить целых 3 таблицы
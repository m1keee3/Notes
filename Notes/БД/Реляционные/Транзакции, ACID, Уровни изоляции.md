## Транзакция

**Транзакция** - это последовательность действий с базой данных, в которой либо все действия выполняются успешно, либо не выполняется ни одно из них.

Транзакция переводит базу данных из одного логически согласованное состояния в другое логически согласованное Результатом транзакции может быть либо совершение изменений (commit), либо откат к исходному состоянию (rollback)

### ACID

Чтобы ваша последовательность действий называлась транзакцией, нужно соблюдение этих свойств ACID:

- **Atomicity** - атомарность: транзакция неделима - либо выполняются все действия, либо ни одного
    
- **Consistency** - согласованность: транзакция переводит одно согласованное состояние базы данных в другое согласованное состояние базы данных без соблюдения поддержки согласованности в промежуточных точках
    
- **Isolation** - изоляция: если запущено несколько конкурирующих транзакций, то любой обновление, выполненное одной транзакцией, скрыто от других до ее завершения
    
- **Durability** - долговечность: когда транзакция завершена, ее результаты сохраняются, даже если в следующий момент произойдет сбой


## Уровни изоляции

### Аномалии 

1. Проблема грязного чтения 
	![[Pasted image 20251029154437.png]]

> **Грязное чтение (Dirty read)** - это когда данные которые я прочитал, кто-то может откатить еще до того, как я завершу свою транзакцию

2. Проблема неповторяющегося чтения 
	![[Pasted image 20251029154801.png]]

> **Неповторяющееся чтение (Non-repeatable read)** - это когда данные, которые я прочитал, кто-то может изменить до того, как я завершу свою транзакцию

3. Проблема фант

Решение - 1 уровень изоляции **READ UNCOMMITED**: требуем, что бы только одна транзакция могла записывать данные

Другой кейс: C решил перевести 100 шекелей к A, а A, получив от C деньги, захотел перевести 200 шекелей B

В итоге первая транзакция может где-то после начисления денег A откатиться, но вторая транзакция выполнилась до отката первой - у A уже нулевой баланс, поэтому у A в ходе отката получится -100

Возникает _проблема грязного чтения_, ее решение - 2 уровень изоляции **“_Завершенное чтение_”**: если какая-то транзакция изменяет данные, то никакая другая не может их читать


